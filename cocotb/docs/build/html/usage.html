<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quickstart Guide &mdash; caravel_cocotb alpha documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python APIs" href="python_api.html" />
    <link rel="prev" title="Welcome to caravel_cocotb’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            caravel_cocotb
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-test">Creating a Test</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#python-template">Python Template</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-template">C Template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-test">Running a Test</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-with-chipcraft">Run with ChipCraft</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-without-chipcraft">Run without ChipCraft</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#check-prerequisites">Check prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-the-repo">Configure the repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-test-tests">Run test/tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-testlist">Creating a Testlist</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checking-results">Checking Results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python_api.html">Python APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="C_api.html">Firmware APIs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caravel_cocotb</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Quickstart Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quickstart-guide">
<span id="usage"></span><h1>Quickstart Guide<a class="headerlink" href="#quickstart-guide" title="Permalink to this heading"></a></h1>
<p>This project aims to provide a user friendly environment for adding and running cocotb tests for <em>Caravel user projects</em>.</p>
<p>Please setup your project through <code class="docutils literal notranslate"><span class="pre">ChipCraft</span></code> as this project is setuped and run through <code class="docutils literal notranslate"><span class="pre">ChipCraft</span></code>.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Add chipcraft docs link or info</p>
</div>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Add link for examples</p>
</div>
<section id="creating-a-test">
<span id="create-test"></span><h2>Creating a Test<a class="headerlink" href="#creating-a-test" title="Permalink to this heading"></a></h2>
<p>A typical test for <em>Caravel</em> consists of 2 parts: <code class="docutils literal notranslate"><span class="pre">Python/cocotb</span></code> code and <code class="docutils literal notranslate"><span class="pre">C</span></code> code.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Python/cocotb</span></code> code is for communicating with <em>Caravel</em> hardware interface inputs, outputs, clock, reset, and power ports/bins. <code class="docutils literal notranslate"><span class="pre">cocotb</span></code> here replaces the <code class="docutils literal notranslate"><span class="pre">verilog</span></code> code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C</span></code> code provides firmware code that would be loaded into the <em>Caravel</em> CPU.</p></li>
</ul>
<p>Tests files has to located under <code class="docutils literal notranslate"><span class="pre">&lt;caravel_user_project&gt;/verilog/dv/cocotb/</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| dv
| ├── cocotb
| │   ├── &lt;new_test&gt;
| │   │   └── &lt;new_test.py&gt;
| │   │   └── &lt;new_test.c&gt;
| │   └── cocotb_tests.py
|
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The name of <code class="docutils literal notranslate"><span class="pre">C</span></code> file must match the name of <code class="docutils literal notranslate"><span class="pre">cocotb</span></code> test function</p>
</div>
<section id="python-template">
<h3>Python Template<a class="headerlink" href="#python-template" title="Permalink to this heading"></a></h3>
<p>The template for <code class="docutils literal notranslate"><span class="pre">python</span></code> test:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cocotb_includes</span> <span class="kn">import</span> <span class="o">*</span> <span class="c1"># import python APIs</span>
<span class="kn">import</span> <span class="nn">cocotb</span>

<span class="nd">@cocotb</span><span class="o">.</span><span class="n">test</span><span class="p">()</span> <span class="c1"># cocotb test marker</span>
<span class="nd">@repot_test</span> <span class="c1"># wrapper for configure test reporting files</span>
<span class="k">async</span> <span class="k">def</span> <span class="o">&lt;</span><span class="n">test_name</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dut</span><span class="p">):</span>
   <span class="n">caravelEnv</span> <span class="o">=</span> <span class="k">await</span> <span class="n">test_configure</span><span class="p">(</span><span class="n">dut</span><span class="p">)</span> <span class="c1">#configure, start up and reset caravel</span>

   <span class="c1">######################## add test sequence ######################</span>
</pre></div>
</div>
<p>Commonly used APIs to monitor or drive the hardware can be found in <a class="reference internal" href="python_api.html"><span class="doc">Python APIs</span></a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>New test python function should be imported into cocotb_tests.py</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="o">&lt;</span><span class="n">new_test</span><span class="o">&gt;.&lt;</span><span class="n">new_test</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">new_test</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</section>
<section id="c-template">
<h3>C Template<a class="headerlink" href="#c-template" title="Permalink to this heading"></a></h3>
<p>The template for Code test:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;common.h&gt;</span><span class="c1"> // include required APIs</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<span class="w">   </span><span class="c1">//////////////////////add test here//////////////////////</span>
<span class="w">   </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Commonly used APIs for firmware can be found in <a class="reference internal" href="C_api.html"><span class="doc">Firmware APIs</span></a></p>
</section>
</section>
<section id="running-a-test">
<span id="run-test"></span><h2>Running a Test<a class="headerlink" href="#running-a-test" title="Permalink to this heading"></a></h2>
<section id="run-with-chipcraft">
<h3>Run with ChipCraft<a class="headerlink" href="#run-with-chipcraft" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">chipcraft</span> <span class="pre">verify</span> <span class="pre">&lt;testname&gt;</span> <span class="pre">--design</span> <span class="pre">&lt;design</span> <span class="pre">name&gt;</span></code></p>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>Add how to run test using chipcraft</p>
</div>
</section>
<section id="run-without-chipcraft">
<h3>Run without ChipCraft<a class="headerlink" href="#run-without-chipcraft" title="Permalink to this heading"></a></h3>
<section id="check-prerequisites">
<h4>Check prerequisites<a class="headerlink" href="#check-prerequisites" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>Docker: <a class="reference external" href="https://hub.docker.com/search?q=&amp;type=edition&amp;offering=community&amp;operating_system=linux&amp;utm_source=docker&amp;utm_medium=webreferral&amp;utm_campaign=dd-smartbutton&amp;utm_location=header">Linux</a> || <a class="reference external" href="https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe?utm_source=docker&amp;utm_medium=webreferral&amp;utm_campaign=dd-smartbutton&amp;utm_location=header">Windows</a> || <a class="reference external" href="https://desktop.docker.com/mac/main/amd64/Docker.dmg?utm_source=docker&amp;utm_medium=webreferral&amp;utm_campaign=dd-smartbutton&amp;utm_location=header">Mac with Intel Chip</a> || <a class="reference external" href="https://desktop.docker.com/mac/main/arm64/Docker.dmg?utm_source=docker&amp;utm_medium=webreferral&amp;utm_campaign=dd-smartbutton&amp;utm_location=header">Mac with M1 Chip</a></p></li>
</ul>
<ul class="simple">
<li><p>Python 3.6+ with PIP</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">`docker</span> <span class="pre">pull</span> <span class="pre">efabless/dv:cocotb`</span></code></p></li>
<li><p>Clone of caravel</p></li>
<li><p>Clone of caravel managment repo</p></li>
<li><p>Clone of PDK from volare</p></li>
<li><p>Clone of caravel user project</p></li>
</ul>
</section>
<section id="configure-the-repo">
<h4>Configure the repo<a class="headerlink" href="#configure-the-repo" title="Permalink to this heading"></a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step is only when first clone the repo.</p>
</div>
<p>Fill the <code class="docutils literal notranslate"><span class="pre">design_info.yaml</span></code> file with repos used as following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
  #yaml file contain general design information that would mostly need to be updated in the first run only 
  #eg CARAVEL_ROOT: &quot;/usr/Desktop/caravel_project/caravel/&quot; 
  #like repo https://github.com/efabless/caravel
  CARAVEL_ROOT: &quot;/usr/caravel_project/caravel/&quot;

  #eg MCW_ROOT: &quot;/usr/Desktop/caravel_project/caravel_mgmt_soc_litex/&quot; 
  #like repo https://github.com/efabless/caravel_mgmt_soc_litex 
  # MCW_ROOT: &quot;/home/rady/caravel/swift/swift2&quot;
  MCW_ROOT: &quot;/usr/caravel_project/caravel_mgmt_soc_litex/&quot;

  #eg USER_PROJECT_ROOT: &quot;/usr/Desktop/caravel_project/caravel_user_project/&quot; 
  #like repo https://github.com/efabless/caravel_user_project
  USER_PROJECT_ROOT: &quot;/usr/caravel_project/&quot;

  #eg PDK_ROOT: &quot;/usr/Desktop/caravel_project/pdk/&quot; 
  #exported by volare
  PDK_ROOT: &quot;/usr/pdk&quot;

  #eg PDK: &quot;sky130A&quot;
  PDK: sky130A
  #PDK: gf180mcuC

  #clock in ns
  clk: 25  

  # true when caravan are simulated instead of caravel
  caravan: false

  # optional email address to send the results to 
  emailto: [None,example@efabless.com]
```
</pre></div>
</div>
</section>
<section id="run-test-tests">
<h4>Run test/tests<a class="headerlink" href="#run-test-tests" title="Permalink to this heading"></a></h4>
<p>Tests can run individually or as a test group using <code class="docutils literal notranslate"><span class="pre">testlist</span></code>. Test can also run in RTL, GL or SDF sims with 8 different coreners.</p>
<p>To a test use run script verify_cocotb:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>usage: verify_cocotb.py [-h] [-regression REGRESSION] [-test TEST [TEST ...]]
                        [-sim SIM [SIM ...]]
                        [-testlist TESTLIST [TESTLIST ...]] [-tag TAG]
                        [-maxerr MAXERR] [-vcs] [-cov] [-checkers_en]
                        [-corner CORNER [CORNER ...]] [-zip_passed]
                        [-emailto EMAILTO [EMAILTO ...]] [-seed SEED]
                        [-no_wave] [-sdf_setup] [-clk CLK] [-lint] [-arm]
                        [-macros MACROS [MACROS ...]] [-sim_path SIM_PATH]

Run caravel cocotb tests

Arguments:
  -h, --help            show this help message and exit
  -test TEST [TEST ...], -t TEST [TEST ...]
                        name of test if no --sim provided RTL will be run
                        &lt;takes list as input&gt;
  -sim SIM [SIM ...]    Simulation type to be run RTL,GL&amp;GL_SDF provided only
                        when run -test &lt;takes list as input&gt;
  -testlist TESTLIST [TESTLIST ...], -tl TESTLIST [TESTLIST ...]
                        path of testlist to be run
  -tag TAG              provide tag of the run default would be regression
                        name and if no regression is provided would be
                        run_&lt;random float&gt;_&lt;timestamp&gt;_
  -maxerr MAXERR        max number of errors for every test before simulation
                        breaks default = 3
  -vcs, -v              use vcs as compiler if not used iverilog would be used
  -corner CORNER [CORNER ...], -c CORNER [CORNER ...]
                        Corner type in case of GL_SDF run has to be provided
  -zip_passed           zip the waves and logs of passed tests. by default if
                        the run has more than 7 tests pass tests results would
                        be zipped automatically
  -emailto EMAILTO [EMAILTO ...], -mail EMAILTO [EMAILTO ...]
                        mails to send results to when results finish
  -seed SEED            run with specific seed
  -no_wave              disable dumping waves
  -clk CLK              define the clock period in ns default defined at
                        design_info.yaml
  -lint                 generate lint log -v must be used
  -macros MACROS [MACROS ...]
                        Add addtional verilog macros for the design
  -sim_path SIM_PATH    directory where simulation result directory &quot;sim&quot;
                        would be created if None it would be created under
                        cocotb folder                    
```
</pre></div>
</div>
<section id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this heading"></a></h5>
<p>#### Run one test in RTL</p>
<p><code class="docutils literal notranslate"><span class="pre">`python3</span> <span class="pre">verify_cocotb.py</span> <span class="pre">-t</span> <span class="pre">&lt;testname&gt;</span> <span class="pre">-tag</span> <span class="pre">run_one_test`</span></code></p>
<p>#### Run 2 tests in GL</p>
<p><code class="docutils literal notranslate"><span class="pre">`python3</span> <span class="pre">verify_cocotb.py</span> <span class="pre">-t</span> <span class="pre">&lt;test1&gt;</span> <span class="pre">&lt;test2&gt;</span>&#160; <span class="pre">-sim</span> <span class="pre">GL`</span></code></p>
<p>#### Run testlist</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span> <span class="pre">python3</span> <span class="pre">verify_cocotb.py</span> <span class="pre">-tl</span> <span class="pre">&lt;path</span> <span class="pre">to</span> <span class="pre">testlist&gt;</span> <span class="pre">-tag</span> <span class="pre">all_rtl</span> <span class="pre">`</span></code></p>
</section>
</section>
</section>
</section>
<section id="creating-a-testlist">
<span id="create-testlist"></span><h2>Creating a Testlist<a class="headerlink" href="#creating-a-testlist" title="Permalink to this heading"></a></h2>
<p>Testlist is a file that contain a collection of test names to run together.</p>
<p>The syntax is simple as <code class="docutils literal notranslate"><span class="pre">YAML</span></code> is used to write the testlist</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Testlist Can has only 2 elements Tests or includes</span>

<span class="c1"># Test element has list of dictionaries of tests to include</span>
<span class="nt">Tests</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;test1&gt;</span><span class="p p-Indicator">,</span><span class="nt"> sim</span><span class="p">:</span><span class="w"> </span><span class="nv">RTL</span><span class="p p-Indicator">}</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;test1&gt;</span><span class="p p-Indicator">,</span><span class="nt"> sim</span><span class="p">:</span><span class="w"> </span><span class="nv">GL</span><span class="p p-Indicator">}</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;test2&gt;</span><span class="p p-Indicator">,</span><span class="nt"> sim</span><span class="p">:</span><span class="w"> </span><span class="nv">RTL</span><span class="p p-Indicator">}</span>

<span class="c1"># include has paths  for other testlist to include in this test list</span>
<span class="c1"># paths are relative to the location of this yaml file</span>
<span class="nt">includes</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;test4&gt;/&lt;testlist&gt;.yaml</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;testlist&gt;.yaml</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../&lt;test5&gt;/&lt;testlist&gt;.yaml</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>Add support for more elements for the test like clock, seed</p>
</div>
</section>
<section id="checking-results">
<h2>Checking Results<a class="headerlink" href="#checking-results" title="Permalink to this heading"></a></h2>
<p>New directory named <code class="docutils literal notranslate"><span class="pre">sim</span></code> would be created under <code class="docutils literal notranslate"><span class="pre">&lt;repo</span> <span class="pre">root&gt;/cocotb/</span></code> or to the path passed to <code class="docutils literal notranslate"><span class="pre">-sim_path</span></code> and it will have all the results.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
| sim #  directory get generate when run a test
│ ├── &lt;tag&gt; # tag of the run  
│ │   ├── &lt;sim type&gt;-&lt;test name&gt; # test result directory contain all logs and wave related to the test
│ │   │   └── &lt;test name&gt;.hex  # hex file used in running this test
│ │   │   └── &lt;test name&gt;.log  # log file generated from cocotb 
│ │   │   └── full.log         # log file has all the command and warning happened if C compilation error happened this file will contain the error msg 
│ │   │   └── &lt;test name&gt;.vcd  # waves can be opened by gtkwave
│ │   │   └── rerun.py         # script to rerun the test
│ │   └── command.log    # command use for this run 
│ │   └── repos_info.log # contain information about the repos used to run these tests 
│ │   └── configs.yaml   # contain information about the repos used to run these tests 
│ │   └── runs.log       # contains status of the run fails and passes tests 
│ ├── hex_files # directory contain all the generated hex files for the runs   
│ 
│ 
``` 
</pre></div>
</div>
<div class="admonition-todo admonition" id="id5">
<p class="admonition-title">Todo</p>
<p>Add description of sim directiory</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to caravel_cocotb’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="python_api.html" class="btn btn-neutral float-right" title="Python APIs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Efabless.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>